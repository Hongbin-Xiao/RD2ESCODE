基于定时器的PWM波形生成系统需求文档
1. 系统概述
本系统基于 AT89X52 微控制器，通过 定时器 T0 中断控制计数器增减，结合延时函数生成 PWM 波形，驱动 LED 实现亮度调节功能。核心功能包括：

定时器中断驱动的计数器循环增减

动态调整 PWM 占空比（通过增减计数器控制高低电平时间）

LED 亮度渐变效果（双向计数切换实现呼吸灯效果）

2. 详细功能需求
2.1 定时器与中断功能
定时器 T0 配置：

工作模式：模式 1（16 位定时器）

初始值：TH0=0xF0, TL0=0xF0（约 1ms 中断一次，具体频率需根据时钟校准）

中断使能：全局中断（EA）和定时器 T0 中断（ET0）开启

中断服务逻辑：

每中断一次，TimeCounter 自增，达到 TIMELINE（分频常数）后触发计数器方向切换。

方向标志位 ArrowFlg：

ArrowFlg=1：upCounter 递增，downCounter 递减。

ArrowFlg=0：upCounter 递减，downCounter 递增。

边界控制：

upCounter 和 downCounter 在 MIN（0x00）和 MAX（0x50）之间循环。

2.2 PWM 波形生成
LED 控制逻辑：

主循环中交替设置 LED=0（低电平）和 LED=1（高电平），延时时间由 downCounter 和 upCounter 控制。

占空比公式：

呼吸灯效果：

计数器双向切换（增→减→增）实现 LED 亮度渐变。

2.3 延时函数
Delay(unsigned int i)：通过嵌套循环实现粗略延时，延时时间与 i 值成正比。

3. 引脚定义
引脚	功能描述
P2^0 (LED)	PWM 波形输出，驱动 LED
4. 功能验证
4.1 定时器中断验证
中断频率测试：

使用示波器测量 LED 引脚波形，验证中断间隔是否符合预期（例如 1ms）。

计数器方向切换：

监控 upCounter 和 downCounter 值，确认在达到 MAX 或 MIN 时方向标志位正确切换。

4.2 PWM 波形验证
占空比范围测试：

验证 upCounter 从 MIN 到 MAX 时，占空比从 0% 渐变至 100%（呼吸灯效果）。

波形稳定性：

检查 PWM 波形周期是否稳定，无抖动或断断续续。

4.3 边界条件测试
计数器溢出测试：确认 upCounter 和 downCounter 在 0x00 和 0x50 之间循环，无越界现象。

5. 数值计算与公式
5.1 定时器初值计算
定时器 T0 初值：

假设晶振频率为 12 MHz，机器周期为 1μs。

定时器初值计算公式：

代码中 TH0=0xF0、TL0=0xF0（初值 0xF0F0 = 61680），定时时长：

5.2 分频常数 TIMELINE
每 TIMELINE 次中断触发一次计数器调整（代码中 TIMELINE=11）。

实际计数器调整周期：

5.3 占空比动态范围
MAX=0x50（十进制 80），占空比范围为：

6. 备注
延时精度：Delay 函数精度较低，建议使用定时器中断实现精确延时。

呼吸灯平滑度：增大 MAX 值可提高亮度渐变平滑度，但需权衡调整速度。

硬件依赖：定时器初值和 TIMELINE 需根据实际晶振频率校准。

